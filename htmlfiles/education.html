<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Noto Sans", sans-serif;
      }

      nav {
        background-color: #c7742b;
        padding: 10px;
      }

      nav ul {
        list-style-type: none;
        text-align: right;
        margin: 0.6rem 2rem;
      }

      nav ul li {
        display: inline-block;
        margin-right: 3rem;
      }

      nav ul li a {
        color: #fff;
        text-decoration: none;
        font-size: 1.1rem;
        
      }

      #writeArticleBtn {
        position: fixed;
        font-size: 1rem;
        top: 80px;
        right: 18px;
        padding: 10px;
        background-color: #fff;
        color: #c7742b;
        border: 1px solid #c7742b;
        border-radius: 5px;

        cursor: pointer;
      }
      .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
      }

      .modal-content {
        background-color: #fefefe;
        margin: 4% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 62%;
        height: 80%;
      }

      .modal-content h2 {
        margin-top: 0;
        font-family: 'Noto Sans', sans-serif;
        padding:2px  5px 7px 5px;
        font-size: 30px;
      }

      .modal-content label,
      .modal-content input,
      .modal-content textarea {
        display: block;
        margin-bottom: 10px;
      }

      #articleContainer {
        margin-top: 70px;
        margin-left: 70px;
      }

      #articleContainer .card{
        margin-right: 20px;
        margin-bottom: 20px;
        background-color: #fff;
        border: 1px solid #c7742b;
      }

      #articleContainer .card h2{
        padding: 6px 0;
      }

      #articleContainer .card p{
        padding: 6px 0;
      }

      #articleContainer .article {
        margin-bottom: 20px;
      }

      #articleContainer .article h3 {
        margin-top: 0;
      }

      #articleContainer .article p {
        padding: 20px 0;
      }

      .firstline{
        display: flex;
        justify-content: space-between;

      }

      .card-container {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .card {
      background-color: #f0f0f0;
      padding: 1rem;
      border-radius: 5px;
      width: 500px;
    }

    .res{
      width:450px;
      border: 1px solid #c7742b;
      border-radius: 5px;
      height: 35px;
    }

    #content{
      width:600px;
      height: 100px;
      resize: none;
    }

    .res1{
      padding: 5px;
      border-radius: 3px;
      border-color: #c7742b;
      background-color: #fff;
      cursor: pointer;
    }
    .res1:hover{
      background-color: #c7742b;
      color: #fff;
    }
    </style>
  </head>

  <body>
    <nav>
      <ul>
        <li><a href="news.html">News</a></li>
      <li><a href="education.html">Articles</a></li>
      <li><a href="profile.html">Profile</a></li>
      </ul>
    </nav>
    <input type="text" id="myChecklist" list="checklistOptions">
    <datalist id="checklistOptions">
      <option value="MANAPURRAM">
      <option value="NMDC">
      <option value="PRAJIND">
      <option value="">
      <!-- Add more options as needed -->
    </datalist>

    <button id="writeArticleBtn">Write Article</button>
  
    <div id="articleContainer" class="card-container"></div>
  
    <div id="writeArticleModal" class="modal">
      <div class="modal-content">
        <div class="firstline">
          <h2>Write Article</h2>
          <button id="closeModalBtn" style="background-color: transparent; border-color: transparent; cursor:pointer;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg"
              viewBox="0 0 16 16">
              <path
                d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z" />
            </svg>
          </button>
        </div>
        <form id="articleForm">
          <label for="title">Title:</label>
          <input type="text" id="title" class="res" required />
          <label for="subHeading">Sub Heading:</label>
          <input type="text" id="subHeading" class="res" required />
          <label for="author">Author:</label>
          <input type="text" id="author" class="res" required />
          <label for="content">Content:</label>
          <textarea id="content" required></textarea>
          <button type="submit" class="res1">Post Article</button>
        </form>
      </div>
    </div>
  
    <div id="signupForm" style="display: none;">
      <h1>Create an Account</h1>
      <form id="signupFormContent" action="/signup" method="POST">
        <input type="text" name="name" placeholder="Full Name" required>
        <input type="email" name="email" id="signupEmail" placeholder="Email" required>
        <input type="password" name="password" placeholder="Password" required>
        <button type="submit" class="btn">Sign Up</button>
      </form>
      <p>Already have an account? <a href="#" onclick="showLogin()">Log In</a></p>
    </div>
  
    <div id="loginForm" style="display: none;">
      <h1>Log In</h1>
      <form id="loginFormContent" action="/login" method="POST">
        <input type="email" name="email" id="loginEmail" placeholder="Email" required>
        <input type="password" name="password" placeholder="Password" required>
        <button type="submit" class="btn">Log In</button>
      </form>
      <p>Don't have an account? <a href="#" onclick="showSignup()">Sign Up</a></p>
    </div>
  
    <script>
      // Get modal element
      const modal = document.getElementById("writeArticleModal");
      // Get button that opens the modal
      const writeArticleBtn = document.getElementById("writeArticleBtn");
      // Get close button
      const closeModalBtn = document.getElementById("closeModalBtn");
      // Get form element
      const articleForm = document.getElementById("articleForm");
      // Get article container element
      const articleContainer = document.getElementById("articleContainer");
      // Get signup form elements
      const signupForm = document.getElementById("signupFormContent");
      const signupEmailInput = document.getElementById("signupEmail");
      // Get login form elements
      const loginForm = document.getElementById("loginFormContent");
      const loginEmailInput = document.getElementById("loginEmail");
  
      // Open the modal
      writeArticleBtn.addEventListener("click", () => {
        modal.style.display = "block";
      });
  
      // Close the modal
      closeModalBtn.addEventListener("click", () => {
        modal.style.display = "none";
        articleForm.reset();
      });
  
      // Function to create an article card
      function createArticleCard(article) {
        // Create card element
        const card = document.createElement("div");
        card.classList.add("card");
  
        // Construct card HTML
        const cardHTML = `
          <h2>${article.title}</h2>
          <h4>${article.subHeading}</h4>
          <p>Author: ${article.author}</p>
          <p>${article.content}</p>
          <p>Time: ${article.time}</p>
        `;
  
        // Set the card HTML as innerHTML of the card element
        card.innerHTML = cardHTML;
  
        return card;
      }
  
      // Function to fetch and display articles
     // Function to fetch and display articles
function fetchAndDisplayArticles() {
  // Make an HTTP GET request to the /articles endpoint
  fetch("/articles")
    .then((response) => response.json())
    .then((data) => {
      console.log("Fetched articles:", data);

      // Clear the article container
      articleContainer.innerHTML = "";

      // Loop through the articles and create article cards
      data.forEach((article) => {
        // Create article card
        const articleCard = createArticleCard(article);

        // Check if user is logged in and populate author field with email
        if (localStorage.getItem("loggedIn")) {
          const email = localStorage.getItem("email");
          const authorField = articleCard.querySelector("input#author");
          if (authorField) {
            authorField.value = email;
          }
        }

        // Append the article card to the article container
        articleContainer.appendChild(articleCard);
      });
    })
    .catch((error) => {
      console.error("Error fetching articles:", error);
      // Handle error, such as showing an error message to the user
    });
}

  
      // Fetch and display articles when the page loads
      fetchAndDisplayArticles();
  
      // Fetch and display articles when the page is opened or refreshed
      window.addEventListener("load", fetchAndDisplayArticles);
  
      // Handle form submission
      articleForm.addEventListener("submit", (e) => {
        e.preventDefault();
  
        // Get form values
        const title = document.getElementById("title").value;
        const subHeading = document.getElementById("subHeading").value;
        const author = document.getElementById("author").value;
        const content = document.getElementById("content").value;
  
        // Get the current time
        const time = new Date().toLocaleTimeString();
  
        // Create article object
        const articleData = {
          title,
          subHeading,
          author,
          content,
          time,
        };
  
        // Make an HTTP POST request to the /articles endpoint
        fetch("/articles", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(articleData),
        })
          .then((response) => response.json())
          .then((data) => {
            console.log("Article submitted successfully:", data);
  
            // Fetch and display articles again
            fetchAndDisplayArticles();
  
            // Reset the form and close the modal
            articleForm.reset();
            modal.style.display = "none";
          })
          .catch((error) => {
            console.error("Error submitting article:", error);
            // Handle error, such as showing an error message to the user
          });
      });
  
      // Show signup form and populate author field with email if logged in
      function showSignup() {
        loginForm.style.display = "none";
        signupForm.style.display = "block";
        if (localStorage.getItem("loggedIn")) {
          const email = localStorage.getItem("email");
          signupEmailInput.value = email;
        }
      }
  
      // Show login form
      function showLogin() {
        signupForm.style.display = "none";
        loginForm.style.display = "block";
      }
  
      // Check if user is logged in
      if (localStorage.getItem("loggedIn")) {
        showSignup();
      }
    </script>
  </body>
  
</html>
